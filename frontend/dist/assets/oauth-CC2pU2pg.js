import{ae as s}from"./index-anYD-FGg.js";import{a as c}from"./types-DlKe2M91.js";const p=r=>{if(!c.includes(r))throw new Error(`Unknown auth option ${r}`);switch(r){case"wallet":return"siwe";default:return r}},u=({authOption:r,client:n,ecosystem:e,mode:o="popup",redirectUrl:t})=>{if(o==="popup"&&t)throw new Error("Redirect URL is not supported for popup mode");if(o==="window"&&!t)throw new Error("Redirect URL is required for window mode");const l=p(r);let i=`${s("inAppWallet")}/api/2024-05-05/login/${l}?clientId=${n.clientId}`;if(e!=null&&e.partnerId?i=`${i}&ecosystemId=${e.id}&ecosystemPartnerId=${e.partnerId}`:e&&(i=`${i}&ecosystemId=${e.id}`),o!=="popup"){const a=new URL(t||window.location.href);a.searchParams.set("walletId",(e==null?void 0:e.id)||"inApp"),a.searchParams.set("authProvider",r),i=`${i}&redirectUrl=${encodeURIComponent(a.toString())}`}return i},I=({authOption:r,client:n,ecosystem:e})=>{const o=p(r);let t=`${s("inAppWallet")}/api/2024-05-05/login/${o}/callback?clientId=${n.clientId}`;return e!=null&&e.partnerId?t=`${t}&ecosystemId=${e.id}&ecosystemPartnerId=${e.partnerId}`:e&&(t=`${t}&ecosystemId=${e.id}`),t},f="width=350, height=500",w=({isWindowOpenedByFn:r,win:n,closeOpenedWindow:e})=>{r?n==null||n.close():n&&e?e(n):n&&n.close()};async function $(r){const n=u({...r,mode:r.mode||"redirect"});r.mode==="redirect"?window.location.href=n:window.open(n),await new Promise(e=>setTimeout(e,5e3))}const U=async r=>{let n=r.openedWindow,e=!1;if(n||(n=window.open(u({...r,mode:"popup"}),`Login to ${r.authOption}`,f),e=!0),!n)throw new Error("Something went wrong opening pop-up");return await new Promise((t,l)=>{const i=window.setInterval(async()=>{n.closed&&(clearInterval(i),window.removeEventListener("message",a),l(new Error("User closed login window")))},1e3),a=async d=>{if(d.origin===s("inAppWallet")){if(typeof d.data!="object"){l(new Error("Invalid event data"));return}switch(d.data.eventType){case"oauthSuccessResult":{window.removeEventListener("message",a),clearInterval(i),w({isWindowOpenedByFn:e,win:n,closeOpenedWindow:r.closeOpenedWindow}),d.data.authResult&&t(d.data.authResult);break}case"oauthFailureResult":{window.removeEventListener("message",a),clearInterval(i),w({isWindowOpenedByFn:e,win:n,closeOpenedWindow:r.closeOpenedWindow}),l(new Error(d.data.errorString));break}}}};window.addEventListener("message",a)})};export{I as a,U as b,u as g,$ as l};
