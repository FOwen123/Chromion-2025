const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DGhR22ix.js","assets/index-anYD-FGg.js","assets/index-SGLETCTz.css","assets/stringify-cJu1y5js.js","assets/read-contract-Cc_S5oDR.js","assets/to-serializable-transaction-CBqCJM9h.js","assets/bundler-CYXS_Fi0.js","assets/addresses-Cbjra2SQ.js","assets/send-eip712-transaction-DutKbSws.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-7vrtgKNj.js","assets/random-Du27Yl4n.js","assets/send-transaction-B8v_N8Fr.js","assets/parse-typed-data-B5i2uSeh.js"])))=>i.map(i=>d[i]);
import{x as T,T as y,g as C,a7 as f,aQ as x,_ as E}from"./index-anYD-FGg.js";import{s as P}from"./types-DlKe2M91.js";import{p as M,f as _}from"./to-serializable-transaction-CBqCJM9h.js";import{o as W,i as F,j as L}from"./bundler-CYXS_Fi0.js";import{r as b}from"./random-Du27Yl4n.js";import"./stringify-cJu1y5js.js";const z=T({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorers:[{name:"Etherscan",url:"https://etherscan.io"}]}),D="0x3f707e6b",S=[{type:"tuple[]",name:"calls",components:[{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}]}],G=[];function N(n){const t=W(async()=>"asyncParams"in n?await n.asyncParams():n);return M({contract:n.contract,method:[D,S,G],params:async()=>[(await t()).calls],value:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.value},accessList:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.accessList},gas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.gas},gasPrice:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.gasPrice},maxFeePerGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.maxFeePerGas},maxPriorityFeePerGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.maxPriorityFeePerGas},nonce:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.nonce},extraGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.extraGas},erc20Value:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.erc20Value},authorizationList:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.authorizationList}})}const A="0xbaC7e770af15d130Cd72838ff386f14FBF3e9a3D",R=n=>{const{client:t,adminAccount:a,sponsorGas:s}=n,c=async e=>{var w;const i=e[0];if(!i)throw new Error("No transactions provided");const r=y(i.chainId),d=C({address:a.address,client:t,chain:r});let h;if(!await H(d)){const u=i.nonce?BigInt(i.nonce)+(s?0n:1n):0n,l=await((w=a.signAuthorization)==null?void 0:w.call(a,{address:A,chainId:i.chainId,nonce:u}));if(!l)throw new Error("Failed to sign authorization");h=l}if(s){const u={calls:e.map(m=>({target:f(m.to??""),value:m.value??0n,data:m.data??"0x"})),uid:b()},l=await a.signTypedData({domain:{name:"MinimalAccount",version:"1",chainId:i.chainId,verifyingContract:d.address},types:{WrappedCalls:[{name:"calls",type:"Call[]"},{name:"uid",type:"bytes32"}],Call:[{name:"target",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"}]},message:u,primaryType:"WrappedCalls"}),I=await F({eoaAddress:f(a.address),wrappedCalls:u,signature:l,authorization:h,options:{client:t,chain:y(i.chainId)}});return{transactionHash:await U({options:{client:t,chain:y(i.chainId)},transactionId:I.transactionId})}}const g=N({contract:d,calls:e.map(u=>({target:u.to??"",value:u.value??0n,data:u.data??"0x"})),overrides:{value:e.reduce((u,l)=>u+(l.value??0n),0n),authorizationList:h?[h]:void 0}}),v=await _({transaction:g,from:a.address});return a.sendTransaction(v)};return{address:a.address,sendTransaction:async e=>c([e]),sendBatchTransaction:async e=>c(e),signMessage:({message:e,originalMessage:i,chainId:r})=>a.signMessage({message:e,originalMessage:i,chainId:r}),signTypedData:e=>a.signTypedData(e)}};async function H(n){const t=await x(n),a=t.length>0&&t.startsWith("0xef0100"),s=`0x${t.slice(8,48)}`;return a&&s.toLowerCase()===A.toLowerCase()}async function U(n){const t=n.timeoutMs||12e4,a=n.intervalMs||1e3,s=Date.now()+t;for(;Date.now()<s;){const c=await L({options:n.options,transactionId:n.transactionId});if(c.transactionHash)return c.transactionHash;await new Promise(o=>setTimeout(o,a))}throw new Error(`Timeout waiting for transaction to be mined on chain ${n.options.chain.id} with transactionId: ${n.transactionId}`)}function Y(n){return n.id==="inApp"||n.id==="embedded"}async function Z(n,t,a){var o,e,i,r;if(((o=t==null?void 0:t.auth)==null?void 0:o.mode)!=="popup"&&((e=t==null?void 0:t.auth)==null?void 0:e.mode)!==void 0&&a.authenticateWithRedirect){const d=n.strategy;P.includes(d)&&await a.authenticateWithRedirect(d,(i=t==null?void 0:t.auth)==null?void 0:i.mode,(r=t==null?void 0:t.auth)==null?void 0:r.redirectUrl)}const c=(await a.connect(n)).user.account;return p({client:n.client,authAccount:c,createOptions:t,desiredChain:n.chain})}async function O(n,t,a){n.authResult&&a.loginWithAuthToken&&await a.loginWithAuthToken(n.authResult);const s=await k(a);if(!s)throw new Error("Failed to authenticate user.");const c=s.account;return p({client:n.client,authAccount:c,createOptions:t,desiredChain:n.chain})}async function B(n){const{connectSmartAccount:t}=await E(async()=>{const{connectSmartAccount:a}=await import("./index-DGhR22ix.js").then(s=>s.i);return{connectSmartAccount:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]));return t({client:n.client,personalAccount:n.authAccount,chain:n.chain},n.smartAccountOptions)}async function k(n){const t=await n.getUser();switch(t.status){case"Logged In, Wallet Initialized":return t}}async function p(n){const{createOptions:t,authAccount:a,desiredChain:s,client:c}=n;let o,e;const i=t&&"executionMode"in t?t.executionMode:void 0;if(i&&(i.mode==="EIP4337"?o=i.smartAccount:i.mode==="EIP7702"&&(e=i)),t&&"smartAccount"in t&&(t!=null&&t.smartAccount)&&(o=t.smartAccount),o){const[r,d]=await B({client:c,authAccount:a,smartAccountOptions:o,chain:s});return{account:r,chain:d,adminAccount:a}}if(e){const r=s;if(!r)throw new Error("Chain is required for EIP-7702 execution, pass a chain when connecting the inAppWallet.");return{account:R({client:c,adminAccount:a,sponsorGas:e.sponsorGas}),chain:r,adminAccount:a}}return{account:a,chain:s||z}}export{O as autoConnectInAppWallet,Z as connectInAppWallet,Y as isInAppWallet};
