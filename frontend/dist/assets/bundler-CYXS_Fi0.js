import{a as b,A as D,j as E,k as T,l as H,g as N,I as O,m as k,o as _,D as L,q as C,r as w}from"./stringify-cJu1y5js.js";import{m as j,n as z,o as q,i as S,P as V,l as W,q as Z}from"./to-serializable-transaction-CBqCJM9h.js";import{ag as K,aL as Q,ah as Y,aB as J,a5 as X,at as ee,av as te,af as U,au as $,aw as h,aZ as ne}from"./index-anYD-FGg.js";class re extends K{constructor(t){super(`Filter type "${t}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const v=j;function se(e){const{abi:t,args:n=[],name:s}=e,c=Q(s,{strict:!1}),a=t.filter(i=>c?i.type==="function"?z(i)===s:i.type==="event"?v(i)===s:!1:"name"in i&&i.name===s);if(a.length===0)return;if(a.length===1)return a[0];let r;for(const i of a){if(!("inputs"in i))continue;if(!n||n.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==n.length)continue;if(n.every((o,f)=>{const p="inputs"in i&&i.inputs[f];return p?G(o,p):!1})){if(r&&"inputs"in r&&r.inputs){const o=M(i.inputs,r.inputs,n);if(o)throw new D({abiItem:i,type:o[0]},{abiItem:r,type:o[1]})}r=i}}return r||a[0]}function G(e,t){const n=typeof e,s=t.type;switch(s){case"address":return b(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in t?Object.values(t.components).every((c,a)=>G(Object.values(e)[a],c)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(e)&&e.every(c=>G(c,{...t,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function M(e,t,n){for(const s in e){const c=e[s],a=t[s];if(c.type==="tuple"&&a.type==="tuple"&&"components"in c&&"components"in a)return M(c.components,a.components,n[s]);const r=[c.type,a.type];if(r.includes("address")&&r.includes("bytes20")?!0:r.includes("address")&&r.includes("string")?b(n[s],{strict:!1}):r.includes("address")&&r.includes("bytes")?b(n[s],{strict:!1}):!1)return r}}const x="/docs/contract/encodeEventTopics";function ie(e){var u;const{abi:t,eventName:n,args:s}=e;let c=t[0];if(n){const o=se({abi:t,name:n});if(!o)throw new E(n,{docsPath:x});c=o}if(c.type!=="event")throw new E(void 0,{docsPath:x});const a=T(c),r=v(a);let i=[];if(s&&"inputs"in c){const o=(u=c.inputs)==null?void 0:u.filter(p=>"indexed"in p&&p.indexed),f=Array.isArray(s)?s:Object.values(s).length>0?(o==null?void 0:o.map(p=>s[p.name]))??[]:[];f.length>0&&(i=(o==null?void 0:o.map((p,l)=>Array.isArray(f[l])?f[l].map((A,m)=>B({param:p,value:f[l][m]})):typeof f[l]<"u"&&f[l]!==null?B({param:p,value:f[l]}):null))??[])}return[r,...i]}function B({param:e,value:t}){if(e.type==="string"||e.type==="bytes")return H(N(t));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new re(e.type);return q([e],[t])}function ae(e,t){if(!b(e,{strict:!1}))throw new O({address:e});if(!b(t,{strict:!1}))throw new O({address:t});return e.toLowerCase()===t.toLowerCase()}const P="/docs/contract/decodeEventLog";function oe(e){const{abi:t,data:n,strict:s,topics:c}=e,a=s??!0,[r,...i]=c;if(!r)throw new k({docsPath:P});const u=t.length===1?t[0]:t.find(d=>d.type==="event"&&r===v(T(d)));if(!(u&&"name"in u)||u.type!=="event")throw new _(r,{docsPath:P});const{name:o,inputs:f}=u,p=f==null?void 0:f.some(d=>!("name"in d&&d.name));let l=p?[]:{};const A=f.filter(d=>"indexed"in d&&d.indexed);for(let d=0;d<A.length;d++){const y=A[d],I=i[d];if(!I)throw new L({abiItem:u,param:y});l[p?d:y.name||d]=ce({param:y,value:I})}const m=f.filter(d=>!("indexed"in d&&d.indexed));if(m.length>0){if(n&&n!=="0x")try{const d=S(m,n);if(d)if(p)l=[...l,...d];else for(let y=0;y<m.length;y++)l[m[y].name]=d[y]}catch(d){if(a)throw d instanceof C||d instanceof V?new w({abiItem:u,data:n,params:m,size:Y(n)}):d}else if(a)throw new w({abiItem:u,data:"0x",params:m,size:0})}return{eventName:o,args:Object.values(l).length>0?l:void 0}}function ce({param:e,value:t}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?t:(S([e],t)||[])[0]}function ue(e){const{abi:t,args:n,logs:s,strict:c=!0}=e,a=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return s.map(r=>{var i;try{const u=t.find(f=>f.type==="event"&&r.topics[0]===v(f));if(!u)return null;const o=oe({...r,abi:[u],strict:c});return a&&!a.includes(o.eventName)||!de({args:o.args,inputs:u.inputs,matchArgs:n})?null:{...o,...r}}catch(u){let o,f;if(u instanceof _)return null;if(u instanceof w||u instanceof L){if(c)return null;o=u.abiItem.name,f=(i=u.abiItem.inputs)==null?void 0:i.some(p=>!("name"in p&&p.name))}return{...r,args:f?[]:{},eventName:o}}}).filter(Boolean)}function de(e){const{args:t,inputs:n,matchArgs:s}=e;if(!s)return!0;if(!t)return!1;function c(a,r,i){try{return a.type==="address"?ae(r,i):a.type==="string"||a.type==="bytes"?H(N(r))===i:r===i}catch{return!1}}return Array.isArray(t)&&Array.isArray(s)?s.every((a,r)=>{if(a==null)return!0;const i=n[r];return i?(Array.isArray(a)?a:[a]).some(o=>c(i,o,t[r])):!1}):typeof t=="object"&&!Array.isArray(t)&&typeof s=="object"&&!Array.isArray(s)?Object.entries(s).every(([a,r])=>{if(r==null)return!0;const i=n.find(o=>o.name===a);return i?(Array.isArray(r)?r:[r]).some(o=>c(i,o,t[a])):!1}):!1}function Ae(e){let t;return()=>(t||(t=e()),t)}function fe(e){const{logs:t,events:n,strict:s}=e;return ue({logs:t,abi:n.map(c=>c.abiEvent),strict:s})}function pe(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="event")}function R(e){const{signature:t}=e;let n;return pe(t)?n=t:n=W(t),{abiEvent:n,hash:j(n),topics:ie({abi:[n],args:e.filters})}}function le(e={}){return R({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function me(e={}){return R({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function ye(e){const{receipt:t}=e,n={...t,transactionHash:t.transactionHash,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs,to:t.to?t.to:null,transactionIndex:t.transactionIndex,status:t.status,type:t.type};return t.blobGasPrice&&(n.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(n.blobGasUsed=BigInt(t.blobGasUsed)),{...e,receipt:n,userOpHash:e.userOpHash,actualGasCost:BigInt(e.actualGasCost),actualGasUsed:BigInt(e.actualGasUsed),nonce:BigInt(e.nonce)}}const we=()=>{const e=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296)),c=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296));return e<<BigInt(160)|t<<BigInt(128)|n<<BigInt(96)|s<<BigInt(64)|c<<BigInt(32)|a};function F(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n==null||X(n)?n:J(n)]))}async function Ge(e){return g({...e,operation:"eth_sendUserOperation",params:[F(e.userOp),e.options.entrypointAddress??$]})}async function Ie(e,t){const n=await g({...e,operation:"eth_estimateUserOperationGas",params:[F(e.userOp),e.options.entrypointAddress??$,t??{}]});return{preVerificationGas:h(n.preVerificationGas),verificationGas:n.verificationGas!==void 0?h(n.verificationGas):void 0,verificationGasLimit:h(n.verificationGasLimit),callGasLimit:h(n.callGasLimit)+ne,paymasterVerificationGasLimit:n.paymasterVerificationGasLimit!==void 0?h(n.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:n.paymasterPostOpGasLimit!==void 0?h(n.paymasterPostOpGasLimit):void 0}}async function Ee(e){const t=await g({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:h(t.maxPriorityFeePerGas),maxFeePerGas:h(t.maxFeePerGas)}}async function Oe(e){var n,s;const t=await he(e);if(t){if(t.success===!1){const a=(s=(n=fe({events:[le(),me()],logs:t.logs})[0])==null?void 0:n.args)==null?void 0:s.revertReason;if(!a)throw new Error(`UserOp failed at txHash: ${t.receipt.transactionHash}`);const r=Z({data:a});throw new Error(`UserOp failed with reason: '${r.args.join(",")}' at txHash: ${t.receipt.transactionHash}`)}return t.receipt}}async function he(e){const t=await g({options:e,operation:"eth_getUserOperationReceipt",params:[e.userOpHash]});if(t)return ye(t)}async function Ue(e){const t=await g({options:e.options,operation:"zk_paymasterData",params:[e.transaction]});return{paymaster:t.paymaster,paymasterInput:t.paymasterInput}}async function xe(e){return{transactionId:(await g({...e,operation:"tw_execute",params:[e.eoaAddress,e.wrappedCalls,e.signature,e.authorization]})).queueId}}async function Be(e){return{transactionHash:(await g({...e,operation:"tw_getTransactionHash",params:[e.transactionId]})).transactionHash}}async function Pe(e){return{transactionHash:(await g({options:e.options,operation:"zk_broadcastTransaction",params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function g(e){const{options:t,operation:n,params:s}=e,c=t.bundlerUrl??ee(t.chain),r=await te(t.client)(c,{method:"POST",headers:{"Content-Type":"application/json"},body:U({jsonrpc:"2.0",id:1,method:n,params:s})}),i=await r.json();if(!r.ok||i.error){let u=i.error||r.statusText;typeof u=="object"&&(u=U(u));const o=i.code||"UNKNOWN";throw new Error(`${n} error: ${u}
Status: ${r.status}
Code: ${o}`)}return i.result}export{Ee as a,we as b,Ue as c,Pe as d,Ie as e,Ge as f,Oe as g,F as h,xe as i,Be as j,Ae as o};
